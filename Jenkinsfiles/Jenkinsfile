node {    

    def image

    stage('Clone repository') {               

        checkout scm   
        sh "pwd"
        sh "ls"
    } 

    stage('Build image') {         
       
        image = docker.build("erizzardi/http-service")
    }

    stage('Test') {
        image.inside {
            try {
                sh 'make test'
            } catch(err) {
                throw err
            }
        }
    }
}